<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:HomeSmartLink.Mobile.ViewModels"
             x:Class="HomeSmartLink.Mobile.Views.LoginPage"
             x:DataType="viewmodels:LoginViewModel"
             NavigationPage.HasNavigationBar="False">

    <Grid BackgroundColor="{StaticResource Background}">
        <ScrollView>
            <Grid Padding="24"
                  RowSpacing="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Header with Logo -->
                <VerticalStackLayout Grid.Row="0"
                                     Spacing="16"
                                     Padding="0,60,0,40">

                    <!-- App Icon -->
                    <Border BackgroundColor="{StaticResource PrimaryMuted}"
                            HeightRequest="88"
                            WidthRequest="88"
                            StrokeShape="RoundRectangle 24"
                            Stroke="{StaticResource Primary}"
                            StrokeThickness="2"
                            HorizontalOptions="Center">
                        <Grid>
                            <BoxView Color="{StaticResource Primary}"
                                     Opacity="0.1" />
                            <Label Text="H"
                                   FontSize="40"
                                   FontFamily="OpenSansSemibold"
                                   TextColor="{StaticResource Primary}"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Grid>
                    </Border>

                    <!-- App Name -->
                    <VerticalStackLayout Spacing="4"
                                         HorizontalOptions="Center">
                        <Label Text="HomeSmartLink"
                               Style="{StaticResource Headline}"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Controlez votre chauffage intelligent"
                               Style="{StaticResource Caption}"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <!-- Login Form -->
                <VerticalStackLayout Grid.Row="1"
                                     Spacing="20"
                                     VerticalOptions="Start">

                    <!-- Error Message -->
                    <Border BackgroundColor="{StaticResource ErrorBg}"
                            StrokeShape="RoundRectangle 12"
                            Stroke="{StaticResource Error}"
                            StrokeThickness="1"
                            Padding="16"
                            IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}">
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="!"
                                   FontSize="18"
                                   FontFamily="OpenSansSemibold"
                                   TextColor="{StaticResource ErrorLight}"
                                   VerticalOptions="Center" />
                            <Label Text="{Binding ErrorMessage}"
                                   TextColor="{StaticResource ErrorLight}"
                                   Style="{StaticResource Body}"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </Border>

                    <!-- Email Field -->
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Adresse email"
                               Style="{StaticResource Caption}"
                               TextColor="{StaticResource TextSecondary}" />
                        <Border Style="{StaticResource InputContainer}">
                            <Entry Text="{Binding Email}"
                                   Placeholder="exemple@email.com"
                                   Keyboard="Email"
                                   ReturnType="Next" />
                        </Border>
                    </VerticalStackLayout>

                    <!-- Password Field -->
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Mot de passe"
                               Style="{StaticResource Caption}"
                               TextColor="{StaticResource TextSecondary}" />
                        <Border Style="{StaticResource InputContainer}">
                            <Entry Text="{Binding Password}"
                                   Placeholder="Votre mot de passe"
                                   IsPassword="True"
                                   ReturnType="Done" />
                        </Border>
                    </VerticalStackLayout>

                    <!-- Remember Me -->
                    <Grid ColumnDefinitions="Auto,*"
                          ColumnSpacing="12"
                          Padding="4,0">
                        <Switch Grid.Column="0"
                                IsToggled="{Binding RememberMe}"
                                VerticalOptions="Center" />
                        <Label Grid.Column="1"
                               Text="Se souvenir de moi"
                               Style="{StaticResource Body}"
                               TextColor="{StaticResource TextSecondary}"
                               VerticalOptions="Center" />
                    </Grid>

                    <!-- Login Button -->
                    <Button Text="Se connecter"
                            Command="{Binding LoginCommand}"
                            IsEnabled="{Binding IsNotBusy}"
                            Margin="0,12,0,0" />

                    <!-- Loading Indicator -->
                    <ActivityIndicator IsRunning="{Binding IsBusy}"
                                       IsVisible="{Binding IsBusy}"
                                       HeightRequest="32"
                                       WidthRequest="32"
                                       HorizontalOptions="Center" />
                </VerticalStackLayout>

                <!-- Footer -->
                <VerticalStackLayout Grid.Row="2"
                                     Spacing="8"
                                     Padding="0,24,0,32">
                    <BoxView HeightRequest="1"
                             Color="{StaticResource BorderColor}"
                             Margin="40,0" />
                    <Label Text="Home-SmartLink v1.0"
                           Style="{StaticResource Caption}"
                           HorizontalTextAlignment="Center" />
                </VerticalStackLayout>
            </Grid>
        </ScrollView>
    </Grid>
</ContentPage>
